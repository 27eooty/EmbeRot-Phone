/* --- å…¨å±€é‡ç½® --- */
* { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif;
    background-color: #000;
    height: 100dvh; /* é€‚é…ç§»åŠ¨ç«¯åŠ¨æ€è§†å£ */
    display: flex;
    justify-content: center;
    align-items: center;
    color: #333;
    overflow: hidden; /* é˜²æ­¢æ»šåŠ¨ */
}

/* --- App å®¹å™¨ --- */
#app-container {
    width: 100%;
    height: 100%;
    background-color: #000;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
}

/* --- é¡µé¢é€šç”¨æ§åˆ¶ --- */
.page {
    display: none;
    flex-direction: column;
    height: 100%;
    width: 100%;
    position: absolute; /* è®©é¡µé¢é‡å ï¼Œæ–¹ä¾¿åšåˆ‡æ¢åŠ¨ç”» */
    top: 0; left: 0;
    background-color: #fff;
}
/* é»˜è®¤æ˜¾ç¤ºä¸»å±å¹• */
.page.active-home { display: flex; z-index: 1; }
/* èŠå¤©å’Œè®¾ç½®é¡µé¢çš„å±‚çº§æ›´é«˜ */
.page.active-app { display: flex; z-index: 10; }

/* =========================================
   iOS ä¸»å±å¹•æ ·å¼ (Home View)
========================================= */
#home-view {
    /* iOS é£æ ¼å£çº¸ */
    background: url('https://images.unsplash.com/photo-1532337874420-636f560c27a7?q=80&w=1080&auto=format&fit=crop') no-repeat center center;
    background-size: cover;
    color: white;
    /* ç§»é™¤ padding-bottomï¼Œå› ä¸º Dock æ˜¯æ‚¬æµ®çš„ */
    /* display: flex;  <-- ç§»é™¤ï¼šäº¤ç”± .page.active-home æ§åˆ¶ */
    /* flex-direction: column; <-- ç§»é™¤ï¼šäº¤ç”± .page æ§åˆ¶ */
    /* ä¿®å¤ Dock å®šä½é—®é¢˜ */
    /* position: relative; <-- ç§»é™¤ï¼šç»Ÿä¸€ä½¿ç”¨ .page çš„ absolute */
    height: 100dvh;
}

/* é¡¶éƒ¨åŒºåŸŸï¼šæ—¶é—´ç»„ä»¶ */
.top-section {
    flex: 0 0 auto; /* ä¸å†å¼ºåˆ¶å æ¯”ï¼Œç”±å†…å®¹å’Œé—´è·å†³å®š */
    margin-top: 60px; /* é¡¶éƒ¨ç•™ç™½ */
    margin-bottom: 30px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
#live-clock { font-size: 80px; font-weight: 200; line-height: 1; } /* è¶…å¤§å·æ—¶é—´ */
#live-date { font-size: 18px; margin-top: 5px; font-weight: 400; }

/* ä¸­éƒ¨åŒºåŸŸï¼šæ ¸å¿ƒç½‘æ ¼ (Bento Layout) */
.middle-section {
    flex: 0 0 auto; /* é«˜åº¦ç”±å†…å®¹å†³å®šï¼Œé˜²æ­¢æ‹‰ä¼¸ */
    display: grid;
    grid-template-columns: 1fr 1fr; /* å·¦å³ä¸¤åˆ—ç­‰å®½ */
    gap: 12px; /* ç´§å‡‘é—´è· */
    padding: 0 20px;
    width: 100%;
    /* ç¡®ä¿å·¦å³é«˜åº¦ä¸€è‡´ */
    align-items: stretch;
}

/* å·¦ä¾§åˆ—ï¼šæ—¥å†ç»„ä»¶ */
.left-column {
    display: flex;
    flex-direction: column;
    height: 100%;
}
.calendar-widget {
    background: rgba(255, 255, 255, 0.25); /* äº®è‰²æ¯›ç»ç’ƒ */
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 22px;
    height: 100%; /* æ’‘æ»¡é«˜åº¦ï¼Œä¸å³ä¾§å¯¹é½ */
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: white;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    /* è§†è§‰ä¸Šæ¥è¿‘æ­£æ–¹å½¢ï¼Œç”±å³ä¾§é«˜åº¦å†³å®š */
}

/* å³ä¾§åˆ—ï¼šApp Grid (2x2) */
.right-column.app-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 12px; /* ä¸ä¸» Grid é—´è·ä¸€è‡´ */
    height: auto; /* é«˜åº¦ç”±å†…å®¹æ’‘å¼€ */
}

/* App å›¾æ ‡é€šç”¨æ ·å¼ */
.app-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    width: 100%;
}
.app-icon {
    width: 60px; /* ç¨å¾®è°ƒå°ä»¥é€‚åº”ç´§å‡‘å¸ƒå±€ */
    height: 60px;
    border-radius: 18px; /* åœ†è§’çŸ©å½¢ */
    background: #ddd;
    margin-bottom: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    color: white;
    transition: transform 0.1s;
}
/* ç§»é™¤æ¶Ÿæ¼ªï¼Œä¿ç•™ç¼©æ”¾ */
.app-item:active .app-icon { transform: scale(0.9); filter: brightness(0.9); }
.app-label { font-size: 12px; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }

/* App é¢œè‰²å®šä¹‰ */
.icon-message { background: linear-gradient(135deg, #34c759, #30b350); }
.icon-music { background: linear-gradient(135deg, #ff2d55, #d62447); }
.icon-camera { background: linear-gradient(135deg, #8e8e93, #636366); }
.icon-map { background: linear-gradient(135deg, #007aff, #005bb5); }
.icon-theme { background: linear-gradient(135deg, #5856d6, #3d3bb5); }
.icon-worldbook { background: linear-gradient(135deg, #007aff, #005bb5); }
.icon-settings { background: linear-gradient(135deg, #8e8e93, #636366); }

/* åº•éƒ¨ Dock æ  */
.dock-container {
    position: absolute; /* å¼ºåˆ¶ç»å¯¹å®šä½ï¼Œç›¸å¯¹äº #home-view */
    bottom: calc(10px + env(safe-area-inset-bottom)); /* é€‚é…åº•éƒ¨å®‰å…¨åŒº */
    width: 100%;
    padding: 0 20px;
    height: 90px;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000; /* ç¡®ä¿å±‚çº§æœ€é«˜ */
}
.ios-dock {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.3); /* æ¯›ç»ç’ƒèƒ¶å›Š */
    backdrop-filter: blur(35px);
    -webkit-backdrop-filter: blur(35px);
    border-radius: 32px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 0 20px;
}
/* Dock å›¾æ ‡ç•¥å° */
.dock-container .app-icon {
    width: 54px;
    height: 54px;
    font-size: 26px;
    margin-bottom: 0;
}
.dock-container .app-label { display: none; }


/* =========================================
   App å†…éƒ¨é€šç”¨æ ·å¼
========================================= */
.app-header {
    height: 50px; /* ç¨å¾®çŸ®ä¸€ç‚¹ï¼Œæ›´åƒ iOS */
    background-color: rgba(249, 249, 249, 0.9); /* åŠé€æ˜å¤´éƒ¨ */
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-bottom: 1px solid #c6c6c8;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 15px;
    font-size: 17px;
    font-weight: 600;
    flex-shrink: 0;
    z-index: 10;
    position: sticky; top: 0; /* å¤´éƒ¨å¸é¡¶ */
    width: 100%;
}
.header-btn { background: none; border: none; color: #007aff; font-size: 16px; cursor: pointer; padding: 5px; display: flex; align-items: center; justify-content: center;}

/* æ»šåŠ¨å†…å®¹åŒºåŸŸ */
.scroll-content {
    flex: 1;
    overflow-y: auto;
    background-color: #fff;
    width: 100%;
}

/* =========================================
   App ä¸»ç•Œé¢ (Tab ç»“æ„)
========================================= */
#app-main-view {
    display: none; /* é»˜è®¤éšè—ï¼Œç”± JS æ§åˆ¶æ˜¾ç¤º */
    flex-direction: column;
    background-color: #fff;
}
#app-main-view.active-app { display: flex; }

/* Tab å†…å®¹é¢æ¿ */
.tab-pane {
    display: none;
    flex: 1;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
}
.tab-pane.active-pane { display: flex; }

/* åº•éƒ¨å¯¼èˆªæ  */
.bottom-tab-bar {
    height: 50px;
    background-color: #f9f9f9;
    border-top: 1px solid #c6c6c8;
    display: flex;
    justify-content: space-around;
    align-items: center;
    flex-shrink: 0;
    width: 100%;
    padding-bottom: env(safe-area-inset-bottom); /* é€‚é… iPhone X åº•éƒ¨ */
}
.tab-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #999;
    cursor: pointer;
    height: 100%;
}
.tab-item.active { color: #007aff; }


/* =========================================
   èŠå¤©çª—å£æ ·å¼
========================================= */
#chat-window { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; display: flex; flex-direction: column; gap: 15px; background-color: #e5e5ea; width: 100%; }

/* æ¶ˆæ¯è¡Œå®¹å™¨ (Flexå¸ƒå±€) */
.message-row {
    display: flex;
    align-items: flex-end; /* å¤´åƒåœ¨åº•éƒ¨ */
    gap: 8px;
    width: 100%;
    position: relative;
    user-select: none; /* é˜²æ­¢é•¿æŒ‰é€‰ä¸­æ–‡æœ¬ */
    -webkit-user-select: none;
}
.message-row.user { flex-direction: row-reverse; }
.message-row.ai { flex-direction: row; }

/* å¤´åƒ */
.message-avatar-img {
    width: 36px; height: 36px;
    border-radius: 50%;
    background-color: #ccc;
    background-size: cover;
    background-position: center;
    flex-shrink: 0;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

/* æ¶ˆæ¯æ°”æ³¡ */
.message-bubble {
    max-width: 70%;
    padding: 10px 14px;
    border-radius: 18px;
    font-size: 16px;
    line-height: 1.4;
    word-wrap: break-word;
    white-space: pre-wrap;
    position: relative;
    transition: transform 0.1s;
}
.message-row:active .message-bubble {
    transform: scale(0.98);
}

.message-row.user .message-bubble {
    background-color: #007aff;
    color: white;
    border-bottom-right-radius: 4px;
}
.message-row.ai .message-bubble {
    background-color: #fff;
    color: black;
    border-bottom-left-radius: 4px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

/* æ—¶é—´åˆ†éš”ç¬¦ (æ¨¡å¼ B) */
.time-separator {
    font-size: 12px;
    color: #8e8e93;
    text-align: center;
    margin: 15px 0;
    width: 100%;
    clear: both;
    font-weight: 500;
}

/* æ°”æ³¡æ—æ—¶é—´æˆ³ (æ¨¡å¼ C & D) - Side-Fixed */
.chat-timestamp {
    font-size: 10px; /* æå°å­—ä½“ */
    color: #888; /* ç¡®ä¿å¯¹æ¯”åº¦ */
    white-space: nowrap;
    min-width: fit-content; /* é˜²æ­¢å®½åº¦å¡Œé™· */
    margin-bottom: 5px; /* åº•éƒ¨å¯¹é½å¾®è°ƒ */
    flex-shrink: 0;
}

/* è°ƒæ•´æ°”æ³¡å¸ƒå±€ä»¥å®¹çº³æ—¶é—´æˆ³ */
.message-row {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    width: 100%;
    position: relative;
    margin-bottom: 6px;
}

/* é’ˆå¯¹ä¸åŒè§’è‰²çš„æ—¶é—´æˆ³ä½ç½® */
/* AI (Left): [Avatar] [Bubble] [Timestamp] */
.message-row.ai .chat-timestamp {
    margin-left: 4px;
}

/* User (Right): [Timestamp] [Bubble] [Avatar] (Visual Order) */
/* DOM Order: [Avatar] [Bubble] [Timestamp] with row-reverse */
.message-row.user .chat-timestamp {
    margin-right: 4px; /* åœ¨ row-reverse ä¸­ï¼Œè¿™å®é™…ä¸Šå¢åŠ äº†ä¸ Bubble çš„é—´è· */
}

/* ç§»é™¤æ—§çš„æ°”æ³¡å†…æ—¶é—´æˆ³æ ·å¼ */
.message-bubble .chat-timestamp {
    display: none;
}

/* æ‰¹é‡é€‰æ‹©æ¨¡å¼ä¸‹çš„ Checkbox */
.msg-checkbox {
    display: none;
    width: 20px; height: 20px;
    margin: 0 10px;
    accent-color: #007aff;
}
.chat-batch-mode .msg-checkbox { display: block; }
/* æ‰¹é‡æ¨¡å¼ä¸‹ï¼Œç‚¹å‡»è¡Œå¯ä»¥è§¦å‘é€‰æ‹©ï¼Œå¢åŠ ç‚¹å‡»åŒºåŸŸ */
.chat-batch-mode .message-row { cursor: pointer; }

/* åº•éƒ¨è¾“å…¥ */
footer { min-height: 50px; background-color: rgba(249, 249, 249, 0.9); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-top: 1px solid #c6c6c8; padding: 8px; display: flex; align-items: flex-end; gap: 10px; width: 100%; padding-bottom: calc(8px + env(safe-area-inset-bottom)); position: relative; z-index: 1000; transition: padding-bottom 0.3s; }
/* å½“é¢æ¿æ‰“å¼€æ—¶ï¼Œfooter çš„ padding-bottom éœ€è¦å½’é›¶ï¼Œå› ä¸ºé¢æ¿ä¼šå æ®åº•éƒ¨å®‰å…¨åŒº */
.panel-open footer { padding-bottom: 8px; }

textarea { flex: 1; padding: 10px; border-radius: 20px; border: 1px solid #c6c6c8; background-color: #fff; resize: none; height: 36px; max-height: 100px; font-family: inherit; font-size: 16px; outline: none; }

/* åº•éƒ¨æŒ‰é’®é€šç”¨æ ·å¼ */
.footer-icon-btn { width: 36px; height: 36px; border-radius: 50%; border: none; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 20px; transition: all 0.2s; }

button#real-send-btn { background-color: #007aff; color: white; font-weight: bold; }
button#real-send-btn:active { background-color: #005bb5; }
button#real-send-btn:disabled { background-color: #ccc; }

button#regen-btn { background-color: #e5e5ea; color: #007aff; font-size: 18px; }
button#regen-btn:active { background-color: #d1d1d6; }
button#regen-btn:disabled { opacity: 0.5; }

button#more-btn { background-color: #e5e5ea; color: #8e8e93; font-weight: 400; font-size: 24px; line-height: 1; }
button#more-btn:active { background-color: #d1d1d6; }
/* é¢æ¿æ‰“å¼€æ—¶æ—‹è½¬ + å· */
.panel-open #more-btn { transform: rotate(45deg); background-color: #d1d1d6; color: #666; }

/* åŠŸèƒ½é¢æ¿ */
#chat-function-panel {
    height: 0;
    overflow: hidden;
    background-color: rgba(249, 249, 249, 0.9);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    padding: 0 20px;
    transition: height 0.3s cubic-bezier(0.25, 0.1, 0.25, 1);
    flex-shrink: 0;
    width: 100%;
    border-top: 1px solid transparent; /* é¿å…è¾¹æ¡†é‡å  */
}
#chat-function-panel.open {
    height: 220px; /* å›ºå®šé«˜åº¦ï¼Œç±»ä¼¼é”®ç›˜ */
    padding-top: 20px;
    padding-bottom: calc(20px + env(safe-area-inset-bottom));
    border-top: 1px solid #c6c6c8;
}

.panel-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    cursor: pointer;
}
.panel-item:active { opacity: 0.7; }

.panel-icon {
    width: 50px; height: 50px;
    background-color: #fff;
    border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    font-size: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    border: 1px solid #e5e5ea;
}
.panel-label { font-size: 12px; color: #666; }

/* Toast æç¤º */
#toast-container {
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    z-index: 9999;
    pointer-events: none; /* å…è®¸ç‚¹å‡»ç©¿é€ */
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
}
.toast-message {
    background-color: rgba(0, 0, 0, 0.75);
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: 500;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    animation: toastFade 2s ease-in-out forwards;
    text-align: center;
    max-width: 80vw;
}
@keyframes toastFade {
    0% { opacity: 0; transform: scale(0.9); }
    10% { opacity: 1; transform: scale(1); }
    80% { opacity: 1; transform: scale(1); }
    100% { opacity: 0; transform: scale(0.95); }
}

/* æ­£åœ¨è¾“å…¥åŠ¨ç”» */
.typing-indicator {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 12px 16px;
    background-color: #e5e5ea;
    border-radius: 18px;
    border-bottom-left-radius: 4px;
    width: fit-content;
    margin-bottom: 10px;
    align-self: flex-start;
}
.typing-dot {
    width: 8px; height: 8px;
    background-color: #8e8e93;
    border-radius: 50%;
    animation: typingBounce 1.4s infinite ease-in-out both;
}
.typing-dot:nth-child(1) { animation-delay: -0.32s; }
.typing-dot:nth-child(2) { animation-delay: -0.16s; }
@keyframes typingBounce {
    0%, 80%, 100% { transform: scale(0); }
    40% { transform: scale(1); }
}

/* =========================================
   è®¾ç½®é¡µé¢æ ·å¼
========================================= */
#settings-view, #chat-settings-view { background-color: #f2f2f7; }
.settings-container { padding: 20px; overflow-y: auto; height: 100%; width: 100%; background-color: #f2f2f7; }
.settings-group { background: #fff; border-radius: 10px; padding: 0 15px; margin-bottom: 25px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
.input-row { padding: 15px 0; border-bottom: 1px solid #e5e5ea; }
.input-row:last-child { border-bottom: none; }
.input-row label { display: block; font-size: 14px; color: #666; margin-bottom: 8px; }
.input-row input, .input-row select, .input-row textarea { width: 100%; border: none; font-size: 17px; font-family: inherit; outline: none; background: transparent; color: #000; }
.input-row textarea { height: 80px; resize: none; }
.connect-btn { background-color: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-size: 14px; cursor: pointer; float: right; font-weight: 500;}

/* =========================================
   èŠå¤©åˆ—è¡¨æ ·å¼ (æ¶ˆæ¯)
========================================= */
#chat-list-container { width: 100%; background-color: #fff; }

.chat-list-item {
    display: flex;
    align-items: center;
    padding: 10px 0 10px 15px; /* å·¦ä¾§ç•™ç™½ï¼Œå³ä¾§å†…å®¹åŒºè´Ÿè´£ä¸‹åˆ’çº¿ */
    cursor: pointer;
    background-color: #fff;
}
.chat-list-item:active { background-color: #f2f2f7; }

.chat-avatar {
    width: 52px; height: 52px;
    border-radius: 50%;
    background-color: #ccc;
    margin-right: 12px;
    display: flex; justify-content: center; align-items: center;
    font-size: 24px; color: white;
    flex-shrink: 0;
    background-size: cover;
    background-position: center;
}

/* æ¶ˆæ¯åˆ—è¡¨çš„å†…å®¹åŒºåŸŸ (å¸¦ä¸‹åˆ’çº¿) */
.chat-list-item .chat-info {
    flex: 1;
    overflow: hidden;
    padding-right: 15px;
    padding-bottom: 10px;
    padding-top: 2px;
    border-bottom: 1px solid #c6c6c8; /* iOS é£æ ¼åˆ†å‰²çº¿ */
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
}
/* æœ€åä¸€ä¸ªå…ƒç´ å»æ‰ä¸‹åˆ’çº¿ (å¯é€‰ï¼Œä½† iOS åˆ—è¡¨é€šå¸¸éƒ½æœ‰) */
/* .chat-list-item:last-child .chat-info { border-bottom: none; } */

.chat-name-row { display: flex; justify-content: space-between; margin-bottom: 4px; align-items: baseline; }
.chat-name { font-weight: 600; font-size: 17px; color: #000; }
.chat-time { font-size: 14px; color: #8e8e93; font-weight: 400; }
.chat-preview { font-size: 15px; color: #8e8e93; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; }

/* =========================================
   é€šè®¯å½•åˆ—è¡¨æ ·å¼ (åˆ—è¡¨)
========================================= */
#contact-list-container { width: 100%; background-color: #fff; }

.contact-list-item {
    display: flex;
    align-items: center;
    padding: 8px 0 8px 15px;
    cursor: pointer;
    background-color: #fff;
}
.contact-list-item:active { background-color: #f2f2f7; }

/* å¤ç”¨ .chat-avatar */

.contact-list-item .chat-info {
    flex: 1;
    overflow: hidden;
    padding-right: 10px;
    padding-top: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #c6c6c8;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.contact-action-icon {
    width: 40px;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #c7c7cc;
    font-size: 20px;
    border-bottom: 1px solid #c6c6c8; /* ä¿æŒåˆ†å‰²çº¿è¿è´¯ */
    padding-top: 10px;
    padding-bottom: 10px;
    margin-right: 15px; /* å³ä¾§ç•™ç™½ */
}

/* ä¸–ç•Œä¹¦æŒ‚è½½åˆ—è¡¨é¡¹ */
.wb-mount-item {
    display: flex;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #e5e5ea;
}
.wb-mount-item:last-child { border-bottom: none; }
.wb-checkbox {
    width: 22px; height: 22px;
    margin-right: 12px;
    accent-color: #007aff;
    cursor: pointer;
}
.wb-info { flex: 1; overflow: hidden; }
.wb-keys { font-weight: 600; font-size: 15px; margin-bottom: 2px; color: #000; }
.wb-preview { font-size: 13px; color: #8e8e93; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* =========================================
   ä¸–ç•Œä¹¦æ ·å¼ (æ–°ç‰ˆ)
========================================= */
#world-book-container { width: 100%; }

/* æ–‡ä»¶å¤¹æ ·å¼ */
.wb-folder {
    background-color: #fff;
    border-radius: 10px;
    margin-bottom: 10px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
.wb-folder-header {
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid transparent;
    transition: background-color 0.2s;
}
.wb-folder-header:active { background-color: #f2f2f7; }
.wb-folder-title { font-weight: 600; font-size: 16px; color: #000; display: flex; align-items: center; gap: 8px; }
.wb-folder-count { font-size: 14px; color: #8e8e93; }
.wb-folder-content { display: none; background-color: #f9f9f9; }
.wb-folder.open .wb-folder-content { display: block; }
.wb-folder.open .wb-folder-header { border-bottom: 1px solid #e5e5ea; }

/* æ¡ç›®æ ·å¼ */
.wb-entry {
    padding: 12px 15px;
    border-bottom: 1px solid #e5e5ea;
    background-color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
}
.wb-entry:last-child { border-bottom: none; }
.wb-entry:active { background-color: #f2f2f7; }
.wb-entry-content { flex: 1; overflow: hidden; }
.wb-entry-keys { font-weight: 600; font-size: 15px; color: #007aff; margin-bottom: 4px; }
.wb-entry-desc { font-size: 13px; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

/* æ‰¹é‡æ“ä½œæ¨¡å¼ */
.batch-mode .wb-folder-header, .batch-mode .wb-entry { padding-left: 10px; }
.batch-checkbox {
    display: none;
    margin-right: 10px;
    width: 20px; height: 20px;
    accent-color: #007aff;
}
.batch-mode .batch-checkbox { display: block; }

/* æ‰¹é‡æ“ä½œåº•æ  */
.batch-bar {
    position: absolute;
    bottom: 0; left: 0; width: 100%;
    height: 60px;
    background-color: rgba(249, 249, 249, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-top: 1px solid #c6c6c8;
    display: flex;
    justify-content: space-around;
    align-items: center;
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 20;
    padding-bottom: env(safe-area-inset-bottom);
}
.batch-mode .batch-bar { transform: translateY(0); }
.batch-btn {
    background: none; border: none;
    font-size: 14px; color: #007aff;
    display: flex; flex-direction: column; align-items: center; gap: 4px;
    cursor: pointer;
}
.batch-btn.delete { color: #ff3b30; }

/* æ¨¡æ€æ¡†æ ·å¼ */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.4);
    z-index: 1000;
    display: flex; justify-content: center; align-items: center;
    backdrop-filter: blur(2px);
}
.modal-content {
    background-color: #fff;
    width: 80%; max-width: 320px;
    border-radius: 14px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    animation: modalPop 0.2s ease-out;
}
@keyframes modalPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.modal-content h3 { text-align: center; padding: 20px 15px 10px; font-size: 18px; font-weight: 600; }
#modal-body { padding: 0 20px 20px; }
.modal-footer { display: flex; border-top: 1px solid #e5e5ea; }
.modal-btn {
    flex: 1; padding: 15px;
    background: none; border: none;
    font-size: 17px; cursor: pointer;
    border-right: 1px solid #e5e5ea;
}
.modal-btn:last-child { border-right: none; }
.modal-btn:active { background-color: #f2f2f7; }
.modal-btn.cancel { color: #007aff; }
.modal-btn.confirm { color: #007aff; font-weight: 600; }
.modal-btn.delete { color: #ff3b30; font-weight: 600; }

/* æ¨¡æ€æ¡†å†…çš„è¾“å…¥æ¡† */
.modal-input {
    width: 100%; padding: 10px;
    border: 1px solid #c6c6c8;
    border-radius: 8px;
    font-size: 16px; margin-bottom: 10px;
    outline: none;
}
.modal-textarea {
    width: 100%; padding: 10px;
    border: 1px solid #c6c6c8;
    border-radius: 8px;
    font-size: 16px; margin-bottom: 10px;
    height: 100px; resize: none;
    outline: none;
}
.modal-select {
    width: 100%; padding: 10px;
    border: 1px solid #c6c6c8;
    border-radius: 8px;
    font-size: 16px; margin-bottom: 10px;
    outline: none; background: #fff;
}

/* =========================================
   ä¸Šä¸‹æ–‡èœå•æ ·å¼ (Context Menu)
========================================= */
.context-menu {
    position: fixed;
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    z-index: 2000;
    overflow: hidden;
    min-width: 180px;
    animation: menuPop 0.15s ease-out;
    transform-origin: top left;
}
@keyframes menuPop {
    from { opacity: 0; transform: scale(0.9); }
    to { opacity: 1; transform: scale(1); }
}

.context-menu-item {
    padding: 12px 16px;
    font-size: 16px;
    color: #000;
    border-bottom: 1px solid rgba(0,0,0,0.1);
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.context-menu-item:last-child { border-bottom: none; }
.context-menu-item:active { background-color: rgba(0,0,0,0.05); }
.context-menu-item.danger { color: #ff3b30; }

/* =========================================
   æ¡Œé¢ç«¯é€‚é… (Responsive)
========================================= */
@media (min-width: 768px) {
    /* é™åˆ¶å†…å®¹æœ€å¤§å®½åº¦å¹¶å±…ä¸­ */
    .middle-section,
    .dock-container,
    #chat-window,
    .settings-container,
    #chat-list-container,
    #world-book-container,
    .bottom-tab-bar,
    .batch-bar {
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }

    /* å¼ºåˆ¶ä¿æŒ Grid å¸ƒå±€ */
    .middle-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
    }

    /* å¤´éƒ¨å’Œåº•éƒ¨ä¹Ÿéœ€è¦é™åˆ¶å†…å®¹å®½åº¦ */
    .app-header {
        padding-left: calc(50% - 400px + 15px);
        padding-right: calc(50% - 400px + 15px);
    }
    
    footer {
        padding-left: calc(50% - 400px + 8px);
        padding-right: calc(50% - 400px + 8px);
    }

    /* Dock æ ç‰¹æ®Šå¤„ç† */
    .dock-container {
        left: 50%;
        transform: translateX(-50%);
        padding: 0; /* ç§»é™¤ paddingï¼Œç”± max-width æ§åˆ¶ */
        bottom: 30px; /* ç¨å¾®æŠ¬é«˜ä¸€ç‚¹ */
    }
    .ios-dock {
        width: 100%;
        max-width: 400px; /* Dock ä¸éœ€è¦å¤ªå®½ */
    }
    
    /* ä¼˜åŒ–æ»šåŠ¨æ¡æ ·å¼ (å¯é€‰) */
    ::-webkit-scrollbar {
        width: 8px;
    }
    ::-webkit-scrollbar-track {
        background: transparent;
    }
    ::-webkit-scrollbar-thumb {
        background: rgba(0,0,0,0.2);
        border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
        background: rgba(0,0,0,0.3);
    }
}

/* =========================================
   è½¬è´¦å¡ç‰‡æ ·å¼ (è¿½åŠ )
========================================= */
.message-card.transfer {
    background: linear-gradient(135deg, #FFD700, #FFA500);
    color: #8B4500;
    border-radius: 18px;
    padding: 15px;
    min-width: 200px;
    box-shadow: 0 4px 15px rgba(255, 165, 0, 0.3);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    position: relative;
    overflow: hidden;
}

.message-card.transfer::before {
    content: 'ğŸ’°';
    font-size: 40px;
    margin-bottom: 5px;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
}

.message-card.transfer .amount {
    font-size: 28px;
    font-weight: 800;
    margin: 5px 0;
    font-family: "SF Pro Display", sans-serif;
}

.message-card.transfer .label {
    font-size: 12px;
    opacity: 0.8;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* çŠ¶æ€æ ·å¼ */
.message-card.transfer.confirmed {
    background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
    color: #2e7d32;
    box-shadow: 0 4px 15px rgba(46, 125, 50, 0.1);
    border: 2px solid #81c784;
}

.message-card.transfer.returned {
    background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
    color: #757575;
    box-shadow: none;
    border: 2px solid #bdbdbd;
    opacity: 0.8;
}

.status-stamp {
    margin-top: 8px;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.message-card.transfer.confirmed .status-stamp {
    background-color: #2e7d32;
    color: white;
}

.message-card.transfer.returned .status-stamp {
    background-color: #757575;
    color: white;
    text-decoration: line-through;
}
